<div class="card-box">
  <h4 class="header-title m-t-0 m-b-30">{{mode=='mode' ? "Enregistrer une Commande d'achat" : 'Enregistrer un
    achat'}}</h4>
  <form [ngBusy]="busy" class="form-horizontal" role="form">


    <div class="form-group row">
      <label class="col-sm-3 control-label">Fournisseur</label>
      <div class="col-sm-6">
        <select class="form-control" name="fournisseurSelect" id="fournisseurSelect">
          <option *ngFor="let f of fournisseurs, let i=index" value="{{i}}">{{f.nom}}</option>
        </select>
      </div>
      <div class="col-sm-3"></div>
    </div>

    <div class="form-group row">
      <label class="col-sm-3 control-label">Numéro du lot</label>
      <div class="col-sm-6">
     <input [(ngModel)]="commande.n_lot" id="commande"
      [ngModelOptions]="{standalone: true}" name="commande" type="number"
            placeholder="numéro du lot" class="form-control " required="">
      </div>
      <div class="col-sm-3"></div>
    </div>



    <table [ngBusy]="busy" class="table table-striped table-bordered  dataTable no-footer" id="datatable"
           role="grid" aria-describedby="datatable_info">
      <thead>
      <tr role="row">
        <th tabindex="0" class="sorting_asc" aria-controls="datatable" style="width: 170px;"
            aria-label="Name: activate to sort column descending" aria-sort="ascending" rowspan="1"
            colspan="1">N°
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Produit
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Quantité
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Montant par unité
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Taxes
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Montant Total
        </th>
        <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
            aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Date d'expiration
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let ligne of commande.lignes_commande_achat; let i = index" role="row">
        <td>
          {{i+1}}
        </td>
        <td>
          <div *ngIf="ligne.editMode!=0">
            <select class="form-control" name="productSelect" id="produitSelect{{i}}">
              <option *ngFor="let product of produits, let j=index" value="{{j}}">{{product.label}}</option>
            </select>
          </div>
          <div *ngIf="ligne.editMode==0">
            {{ligne.produit_base.label}}
          </div>
        </td>
        <td>
          <div *ngIf="ligne.editMode!=0 && ligne.produit_base" style="display: inline-block">
            <input [(ngModel)]="ligne.quantite" [ngModelOptions]="{standalone: true}"
                   (ngModelChange)="changeCoutLigne(i)" name="quantity" type="number"
                   placeholder="Qté en {{ligne.produit_base.unite.indice}}" class="form-control " required="">
          </div>
          <div *ngIf="ligne.editMode==0 && ligne.produit_base">
            {{ligne.quantite}} {{ligne.produit_base.unite.indice}}
          </div>
        </td>
        <td>
          <div *ngIf="ligne.editMode!=0" style="display: inline-block">
            <input [(ngModel)]="ligne.cout_unite" (ngModelChange)="changeCoutLigne(i)" id="cout"
                   [ngModelOptions]="{standalone: true}" name="cout" type="number"
                   placeholder="Cout/{{ligne.produit_base.unite.indice}}" class="form-control " required="">
          </div>
          <div *ngIf="ligne.editMode==0">
            {{ligne.cout_unite}} DT
          </div>
        </td>
        <td>
          <div *ngIf="ligne.produit_base.taxes && ligne.produit_base.taxes.length!=0">
            <a *ngFor="let taxe of ligne.produit_base.taxes" class="label-danger label text-white"
               style="margin-right: 3px">
              {{taxe.label}}
              {{taxe.pourcentage}}
              %</a>
          </div>
          <div *ngIf="!ligne.produit_base.taxes || ligne.produit_base.taxes.length == 0">
            <a class="label label-success text-white">Pas de taxes</a>
          </div>
        </td>
        <td *ngIf="ligne.produit_base">
          {{ligne.cout}}
          DT
        </td>
        <td>
          <input *ngIf="ligne.editMode!=0"
          [(ngModel)]="ligne.date_expiration" id="date_exp"
          [ngModelOptions]="{standalone: true}" name="date_exp" type="date"
                    class="form-control " required="">
          <span *ngIf="ligne.editMode==0">
                  {{ligne.date_expiration}}
          </span>
        </td>

        <td>
          <div *ngIf="ligne.editMode!=0">
            <a (click)="confirmLigne(i)" class="on-editing save-row"
               data-toggle="tooltip" title="Confirmer">
              <i class="fa fa-save"></i></a>
          </div>
          <div *ngIf="ligne.editMode==0">
            <a (click)="editLigne(i)" class="text-inverse p-r-10"
               data-toggle="tooltip" title="Confirmer">
              <i class="fa fa-pencil"></i></a>
            <a (click)="deleteLigne(i)" class="text-inverse p-r-10"
               data-toggle="tooltip" title="Delete">
              <i class="fa fa-trash-o"></i></a>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
    <div class="form-group row" style="margin-top:2%;" *ngIf="mode=='achat'">
      <label class="col-sm-11 control-label">Remise%:</label>
      <div class="col-sm-1">
        <input [(ngModel)]="remise" (ngModelChange)="onChangePrice()" class=" col-xs-3 form-control" type="number" name="remise">
      </div>
      <div class="col-sm-3"></div>
    </div>
  </form>

  <div class="row">
    <div class="col-md-6 col-sm-6 col-xs-6">
      <div class="clearfix m-t-40">
      </div>
    </div>
    <div class="col-md-3 col-sm-6 col-xs-6 col-md-offset-3">
      <h3 class="text-right"> {{montant? montant:0}} DT</h3>
    </div>
    <div class="hidden-print">
      <div class="pull-right">
        <a href="javascript:window.print()" class="btn btn-inverse waves-effect waves-light"><i class="fa fa-print"></i></a>
        <a href="javascript:" (click)="submit()" class="btn btn-primary waves-effect waves-light">Submit</a>
      </div>
    </div>
  </div>


</div>

