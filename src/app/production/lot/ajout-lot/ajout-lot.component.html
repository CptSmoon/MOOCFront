<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class="card-box">
        <form class="form-horizontal" [ngBusy]="busy">

          <fieldset>

            <!-- Form Name -->
            <legend>Ajouter un Lot</legend>

            <!-- Text input-->
            <div class="form-group">
              <label class="col-md-4 control-label" for="textinput">Label</label>
              <div class="col-md-4">
                <input [(ngModel)]="lot.label" id="textinput" name="textinput" type="text"
                       placeholder="Label du lot" class="form-control input-md" required="required">

              </div>
            </div>

            <!-- Text input-->
            <div class="form-group">
              <label class="col-md-4 control-label" for="reference">Référence</label>
              <div class="col-md-4">
                <input [(ngModel)]="lot.reference" id="reference" name="reference" type="text"
                       placeholder="Référence du lot" class="form-control input-md" required="required">

              </div>
            </div>

            <!-- Text input-->
            <div class="form-group">
              <label class="col-md-4 control-label" for="productSelect">Produit</label>
              <div class="col-md-4">
                <select class="select-product form-control" name="productSelect" id="productSelect">
                  <option *ngFor="let product of produits, let j=index" value="{{j}}">{{product.label}}</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-4 control-label" for="expiration">Expiration (jours)</label>
              <div class="col-md-4">
               <input [(ngModel)]="lot.expiration" id="expiration" name="expiration" type="text"
                                      placeholder="Nombre de jours avant expiration" class="form-control input-md" required="required">

              </div>
            </div>
            <div class="  form-group">
              <div class="card-box col-md-4 col-md-offset-4 ">
                <h4 class="header-title  m-t-0 m-b-30">Composition du Lot</h4>
                <form class="form-horizontal" role="form">


                  <table class="table  table-striped table-bordered  dataTable no-footer" id="datatable"
                         role="grid" aria-describedby="datatable_info">
                    <thead>
                    <tr role="row">
                      <th tabindex="0" class="sorting_asc" aria-controls="datatable" style="width: 170px;"
                          aria-label="Name: activate to sort column descending" aria-sort="ascending" rowspan="1"
                          colspan="1">N°
                      </th>
                      <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
                          aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Produit de
                        Base
                      </th>

                      <th tabindex="0" class="sorting" aria-controls="datatable" style="width: 116px;"
                          aria-label="Start date: activate to sort column ascending" rowspan="1" colspan="1">Quantité
                      </th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let ligne of lot.produit?.produit_produit_bases;
      let i = index" role="row">
                      <td>
                        {{i+1}}
                      </td>

                      <td>
                        {{ligne.produit_base.label}} ( {{ligne.quantite}} {{ligne.produit_base.unite.indice}} /piece)
                      </td>


                      <td>
                        <input (change)="quantiteChanged(ligne.quantite,ligne.quantite_totale,i)"
                               [(ngModel)]="ligne.quantite_totale" id="quantite" name="quantite" type="number"
                               placeholder="Quantité" class="form-control input-md" required="">
                      </td>

                    </tr>
                    </tbody>
                  </table>
                </form>


              </div>
            </div>
            <!-- Text input-->
            <div class="  form-group">
              <label class="col-md-4 control-label" for="quantite_calculee">Quantité Éstimée</label>
              <div *ngIf="lot.quantite_calculee!=99999" class="col-md-4">
                {{lot.quantite_calculee}} Pièces
              </div>
            </div>

            <!-- Text input-->
            <div class="form-group">
              <label class="col-md-4 control-label" for="quantite_voulue">Quantitée Voulue</label>
              <div class="col-md-4">
                <input [(ngModel)]="lot.quantite_voulue" id="quantite_voulue" name="quantite_voulue" type="number"
                       placeholder="Quantité Voulue" class="form-control input-md" required="required">
              </div>
            </div>

            <div class="  form-group">
              <label class="col-md-4 control-label" >Coût / Bénéfice</label>
              <div class="col-md-4">
               {{lot.cout? lot.cout : 0 * lot.produit.prix}} /
                {{lot?.quantite_voulue * lot.produit?.prix}} DT
              </div>
            </div>


            <!-- Button (Double) -->
            <div class="form-group">
              <div class="col-md-4 col-md-offset-5">
                <button *ngIf="isEditAction == false" (click)="addLot()"
                        id="buttonSubmit" name="buttonSubmit" class="btn btn-success">Ajouter
                </button>
                <button *ngIf="isEditAction == true" (click)="editLot()" id="buttonSubmit"
                        name="buttonSubmit" class="btn btn-success">Modifier
                </button>
                <button [routerLink]="['/production/lot/list']" id="buttonAnnuler" name="buttonAnnuler"
                        class="btn btn-warning">Annuler
                </button>
              </div>
            </div>
          </fieldset>
        </form>


      </div>
    </div>
  </div>
</div>
